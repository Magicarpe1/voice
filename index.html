<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Réservation Express</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcL0S_zj3w-AqPnRYEGjMiT2P1UutX3LE&libraries=places"></script>

  <style>
    body {
      background: #121212;
      font-family: sans-serif;
      color: #FFF;
      padding: 20px;
    }

    .pac-container {
      background-color: #262626 !important;
      color: #CCC !important;
      border-radius: 8px;
      border: 1px solid #333;
      font-family: sans-serif;
    }

    .pac-item {
      color: #CCC !important;
      padding: 8px 12px;
    }

    .pac-item:hover {
      background-color: #333 !important;
    }

    .pac-icon {
      filter: invert(100%) brightness(80%);
    }

    input[type="date"], 
    input[type="time"],
    input[type="text"] {
      color-scheme: dark;
      background:#262626;
      color:#FFF;
      width:100%;
      margin-top:8px;
      padding:10px 15px;
      border-radius:8px;
      border:none;
      box-sizing:border-box;
    }

    ::-webkit-calendar-picker-indicator {
      filter: invert(1);
      cursor: pointer;
    }

    .label-with-icon {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .icon-svg {
      width: 20px;
      height: 20px;
      vertical-align: middle;
      fill: currentColor;
    }
    .preset-btn {
      flex: 1;
      font-size: 12px;
      padding: 6px;
      text-align: center;
      background-color: #262626;
      color: #FFF;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .preset-btn:hover {
      background-color: #333;
    }

  </style>
</head>

<body>

<div style="background:#1A1A1A;border-radius:12px;padding:30px;max-width:1100px;margin:auto;box-sizing:border-box;">
  <div style="margin-bottom:20px;">
    <h2 style="font-size:22px;">Réservation Express</h2>
  </div>

  <div style="display:flex;gap:30px;">
    <div style="flex:1;">
      <label class="label-with-icon">
        Lieu de départ
      </label>
      <input id="autocomplete_depart" placeholder="Entrez votre lieu de départ" type="text">

<div style="display:flex;gap:5px;margin-top:8px;flex-wrap:wrap;">
  <button class="preset-btn" data-input="autocomplete_depart" data-adresse="18 Rue de Dunkerque, 75010 Paris">Gare du Nord</button>
  <button class="preset-btn" data-input="autocomplete_depart" data-adresse="17 Boulevard de Vaugirard, 75015 Paris">Montparnasse</button>
  <button class="preset-btn" data-input="autocomplete_depart" data-adresse="Place Louis-Armand, 75012 Paris">Gare de Lyon</button>
  <button class="preset-btn" data-input="autocomplete_depart" data-adresse="Aéroport Charles de Gaulle, Roissy-en-France">CDG</button>
  <button class="preset-btn" data-input="autocomplete_depart" data-adresse="Aéroport d'Orly, 94390 Orly">Orly</button>
</div>

      <label style="display:block;margin-top:20px;">
        Date
      </label>
      <input type="date" placeholder="Date">
    </div>

    <div style="flex:1;">
      <label class="label-with-icon">
        Destination
      </label>
      <input id="autocomplete_destination" placeholder="Entrez votre destination" type="text">

<div style="display:flex;gap:5px;margin-top:8px;flex-wrap:wrap;">
  <button class="preset-btn" data-input="autocomplete_destination" data-adresse="18 Rue de Dunkerque, 75010 Paris">Gare du Nord</button>
  <button class="preset-btn" data-input="autocomplete_destination" data-adresse="17 Boulevard de Vaugirard, 75015 Paris">Montparnasse</button>
  <button class="preset-btn" data-input="autocomplete_destination" data-adresse="Place Louis-Armand, 75012 Paris">Gare de Lyon</button>
  <button class="preset-btn" data-input="autocomplete_destination" data-adresse="Aéroport Charles de Gaulle, Roissy-en-France">CDG</button>
  <button class="preset-btn" data-input="autocomplete_destination" data-adresse="Aéroport d'Orly, 94390 Orly">Orly</button>
</div>


      <label style="display:block;margin-top:20px;" class="label-with-icon">
        Heure
      </label>
      <input type="time" placeholder="Heure">
    </div>
  </div>

  <div style="background-color:#262626;border-radius:12px;padding:25px;text-align:center;margin-top:25px;">
    <img src="https://ik.imagekit.io/lakolo/eyJidWNrZXQiOiJkYXRhay1jZG4teHkiLCJlZGl0cyI6e30sImtleSI6ImNvbmZpZ3VyYXRvci1pbWdzL2NhcnMvZnIvODAwL1RPWU9UQS9QUk9BQ0UtVkVSU08tRUxFQ1RSSUMvNDg3NThfTU9OT1NQQUNFLTUtUE9SVEVTL25vaXItcGVybGEtbmVyYS1tZXRhbGxpc2UucG5nIn0=.png?updatedAt=1746260324316"
      alt="Voiture sélectionnée" style="width:250px;margin:auto;">

    <h3 style="margin-top:15px;">TOYOTA PROACE</h3>
    <div style="color:#AAA;">Passagers : 9</div>
  </div>

<div style="display:flex;justify-content:space-between;align-items:center;margin-top:25px;gap:15px;">

  <!-- Saisie numéro de téléphone avec image -->
  <div style="display:flex;align-items:center;gap:8px;">
    <img src="https://ik.imagekit.io/lakolo/pngwing.com%20(6).png?updatedAt=1748077033496"
         alt="Téléphone" style="width:24px;height:24px;">
    <input type="tel" id="telephone" placeholder="Numéro de téléphone" 
           style="background:#262626;color:#FFF;padding:10px 15px;border:none;border-radius:8px;width:180px;">
  </div>

  <!-- Nombre de personnes -->
  <div style="display:flex;align-items:center;font-size:16px;gap:8px;">
    <!-- Icône SVG -->
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 256 256" fill="#FFF">
      <path d="M117.25 157.92a60 60 0 1 0-66.5 0a95.83 95.83 0 0 0-47.22 37.71a8 8 0 1 0 13.4 8.74a80 80 0 0 1 134.14 0a8 8 0 0 0 13.4-8.74a95.83 95.83 0 0 0-47.22-37.71M40 108a44 44 0 1 1 44 44a44.05 44.05 0 0 1-44-44m210.14 98.7a8 8 0 0 1-11.07-2.33A79.83 79.83 0 0 0 172 168a8 8 0 0 1 0-16a44 44 0 1 0-16.34-84.87a8 8 0 1 1-5.94-14.85a60 60 0 0 1 55.53 105.64a95.83 95.83 0 0 1 47.22 37.71a8 8 0 0 1-2.33 11.07"/>
    </svg>
    <button id="btn-moins" style="margin:0 10px;width:30px;height:30px;border-radius:50%;border:none;background:#262626;color:#FFF;">–</button>
    <span id="nombre-personnes">1</span>
    <button id="btn-plus" style="margin:0 10px;width:30px;height:30px;border-radius:50%;border:none;background:#262626;color:#FFF;">+</button>
  </div>

 <!-- Prix estimé et boutons -->
<div style="display:flex;align-items:center;gap:10px;">
  <div id="prixEstime" style="color:#FFF;font-weight:bold;background-color:#262626;padding:10px 15px;border-radius:6px;display:none;"></div>
  <button id="estimate-btn" style="background-color:#444;color:#FFF;border:none;padding:12px 20px;border-radius:6px;">ESTIMER LE PRIX</button>
  <button id="btn-reserver" style="background-color:#007bff;color:#FFF;border:none;padding:12px 20px;border-radius:6px;">RÉSERVER</button>
</div>

<script src="https://cdn.emailjs.com/sdk/latest/email.min.js"></script>
<script>
  let autocompleteDepart, autocompleteDestination;

  function initAutocomplete() {
    const options = { types: ['geocode'], componentRestrictions: { country: 'fr' } };
    autocompleteDepart = new google.maps.places.Autocomplete(document.getElementById('autocomplete_depart'), options);
    autocompleteDestination = new google.maps.places.Autocomplete(document.getElementById('autocomplete_destination'), options);
  }

  function estimerPrix() {
    const depart = document.getElementById('autocomplete_depart').value;
    const destination = document.getElementById('autocomplete_destination').value;
    const prixEstime = document.getElementById('prixEstime');

    if (!depart || !destination) {
      prixEstime.textContent = "Veuillez saisir les lieux de départ et de destination.";
      prixEstime.style.display = "block";
      return;
    }

    const directionsService = new google.maps.DirectionsService();
    directionsService.route({
      origin: depart,
      destination: destination,
      travelMode: google.maps.TravelMode.DRIVING,
    }, (response, status) => {
      if (status === 'OK') {
        const distanceEnMetres = response.routes[0].legs[0].distance.value;
        const distanceEnKm = distanceEnMetres / 1000;

        let prixTotal;
        if (distanceEnKm < 4) {
          prixTotal = 10;
        } else {
          prixTotal = distanceEnKm * 2.5;
        }

        prixEstime.textContent = `Distance : ${distanceEnKm.toFixed(1)} km | Prix : ${prixTotal.toFixed(2)} €`;
        prixEstime.style.display = "block";
      } else {
        prixEstime.textContent = "Erreur lors du calcul";
        prixEstime.style.display = "block";
      }
    });
  }

  window.addEventListener('load', () => {
    emailjs.init("yx7ldLiDmVC_uNq1N");
    initAutocomplete();

    document.getElementById('estimate-btn').addEventListener('click', estimerPrix);

    document.querySelectorAll('.preset-btn').forEach(btn => {
      btn.addEventListener('click', (event) => {
        const adresse = event.currentTarget.getAttribute('data-adresse');
        const inputId = event.currentTarget.getAttribute('data-input');
        document.getElementById(inputId).value = adresse;
      });
    });

    let nombrePersonnes = 1;
    const minPersonnes = 1;
    const maxPersonnes = 9;

    const affichagePersonnes = document.getElementById('nombre-personnes');
    const btnMoins = document.getElementById('btn-moins');
    const btnPlus = document.getElementById('btn-plus');

    btnMoins.addEventListener('click', () => {
      if (nombrePersonnes > minPersonnes) {
        nombrePersonnes--;
        affichagePersonnes.textContent = nombrePersonnes;
      }
    });

    btnPlus.addEventListener('click', () => {
      if (nombrePersonnes < maxPersonnes) {
        nombrePersonnes++;
        affichagePersonnes.textContent = nombrePersonnes;
      }
    });

    document.getElementById('btn-reserver').addEventListener('click', () => {
      const prixEstimeText = document.getElementById('prixEstime').textContent;
      
      if (!prixEstimeText.includes("Prix")) {
        alert("Tu dois d'abord estimer le prix !");
        return;
      }

      const prixEstime = parseFloat(prixEstimeText.match(/Prix : (\d+\.\d+)/)[1]);
      const amount = prixEstime * 100;

      const reservationData = {
        lieu_depart: document.getElementById('autocomplete_depart').value,
        lieu_arrivee: document.getElementById('autocomplete_destination').value,
        date: document.querySelector('input[type="date"]').value,
        heure: document.querySelector('input[type="time"]').value,
        telephone: document.getElementById('telephone').value,
        prix: prixEstimeText,
        nombre_personnes: nombrePersonnes
      };

      emailjs.send("service_8m9y4b7", "template_jjf7ayv", reservationData)
      .then(() => {
        fetch("https://stripe-checkout-server-ksq4.onrender.com/create-checkout-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ amount: amount }),
        })
        .then(res => res.json())
        .then(data => {
          if (data.url) {
            window.location.href = data.url; 
          } else {
            alert("Erreur lors du paiement : " + data.error);
          }
        })
        .catch(err => console.error("Erreur Fetch :", err));
      })
      .catch(err => console.error("Erreur EmailJS :", err));
    });
  });
</script>


</body>
</html>
